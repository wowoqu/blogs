<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise 使用 | wowoqu的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blogs/images/logo/panda.png">
    <meta name="description" content="技术不完全指北手册">
    
    <link rel="preload" href="/blogs/assets/css/0.styles.7f314dd1.css" as="style"><link rel="preload" href="/blogs/assets/js/app.0e5649ea.js" as="script"><link rel="preload" href="/blogs/assets/js/2.9858e944.js" as="script"><link rel="preload" href="/blogs/assets/js/29.ff31abe2.js" as="script"><link rel="prefetch" href="/blogs/assets/js/10.6a95d1ac.js"><link rel="prefetch" href="/blogs/assets/js/11.f122dbaa.js"><link rel="prefetch" href="/blogs/assets/js/12.a0234d27.js"><link rel="prefetch" href="/blogs/assets/js/13.07d2f5a8.js"><link rel="prefetch" href="/blogs/assets/js/14.f3c6ca05.js"><link rel="prefetch" href="/blogs/assets/js/15.10055607.js"><link rel="prefetch" href="/blogs/assets/js/16.cb904769.js"><link rel="prefetch" href="/blogs/assets/js/17.8fdfa7a7.js"><link rel="prefetch" href="/blogs/assets/js/18.1b3ae4b5.js"><link rel="prefetch" href="/blogs/assets/js/19.dbfe90f1.js"><link rel="prefetch" href="/blogs/assets/js/20.88442ff2.js"><link rel="prefetch" href="/blogs/assets/js/21.9dc3e600.js"><link rel="prefetch" href="/blogs/assets/js/22.d53a8053.js"><link rel="prefetch" href="/blogs/assets/js/23.95679025.js"><link rel="prefetch" href="/blogs/assets/js/24.7950a580.js"><link rel="prefetch" href="/blogs/assets/js/25.6600a97a.js"><link rel="prefetch" href="/blogs/assets/js/26.6ddf4b42.js"><link rel="prefetch" href="/blogs/assets/js/27.2ce909b0.js"><link rel="prefetch" href="/blogs/assets/js/28.b04654c0.js"><link rel="prefetch" href="/blogs/assets/js/3.88c3d22f.js"><link rel="prefetch" href="/blogs/assets/js/30.d5767a77.js"><link rel="prefetch" href="/blogs/assets/js/31.9f2bc950.js"><link rel="prefetch" href="/blogs/assets/js/4.fa83c5fa.js"><link rel="prefetch" href="/blogs/assets/js/5.9c192d2d.js"><link rel="prefetch" href="/blogs/assets/js/6.744a911e.js"><link rel="prefetch" href="/blogs/assets/js/7.43996d55.js"><link rel="prefetch" href="/blogs/assets/js/8.177ef4b4.js"><link rel="prefetch" href="/blogs/assets/js/9.597852c6.js">
    <link rel="stylesheet" href="/blogs/assets/css/0.styles.7f314dd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/" class="home-link router-link-active"><img src="/blogs/images/logo/panda.png" alt="wowoqu的博客" class="logo"> <span class="site-name can-hide">wowoqu的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blogs/shell/" class="nav-link">
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/blogs/vim/" class="nav-link">
  Vim
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Javascript" class="mobile-dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/promise/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Promise
</a></li></ul></div></div><div class="nav-item"><a href="/blogs/docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="https://github.com/wowoqu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blogs/shell/" class="nav-link">
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/blogs/vim/" class="nav-link">
  Vim
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Javascript" class="mobile-dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/promise/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Promise
</a></li></ul></div></div><div class="nav-item"><a href="/blogs/docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="https://github.com/wowoqu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Promise</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/promise/" aria-current="page" class="active sidebar-link">Promise 使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/promise/#promise-介绍" class="sidebar-link">Promise 介绍</a></li><li class="sidebar-sub-header"><a href="/blogs/promise/#要点总结" class="sidebar-link">要点总结</a></li><li class="sidebar-sub-header"><a href="/blogs/promise/#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/blogs/promise/PromiseSourceCode.html" class="sidebar-link">Promise 原理</a></li><li><a href="/blogs/promise/PromiseTest.html" class="sidebar-link">Promise 练习</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promise-使用"><a href="#promise-使用" class="header-anchor">#</a> Promise 使用</h1> <h2 id="promise-介绍"><a href="#promise-介绍" class="header-anchor">#</a> Promise 介绍</h2> <p>Promise 翻译过来是 <code>承诺</code> 的意思，它的诞生主要是为了解决 <code>JavaScript 异步编程</code> 以及 <code>JavaScript 异步编程</code> 带来的 <code>回调地狱</code> 等问题的。</p> <h3 id="promise-之前的-异步回调"><a href="#promise-之前的-异步回调" class="header-anchor">#</a> Promise 之前的 异步回调</h3> <p>在 Promise 出来之前，我们要实现在异步完成后执行某操作的话，需要在异步函数内添加回调函数，这也是因为 JavaScript 是异步非阻塞的特性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>而如果我们需要 <code>依次</code> 请求一系列接口，并且后一个请求的数据<code>依赖于上一个请求</code>的结果，则有如下的代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 依次请求接口</span>
<span class="token comment">// http://foo.example.com/1</span>
<span class="token comment">// http://foo.example.com/2</span>
<span class="token comment">// http://foo.example.com/3</span>
<span class="token comment">// http://foo.example.com/4</span>

<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'http://foo.example.com/1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something...</span>
    <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'http://foo.example.com/2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Do something...</span>
        <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'http://foo.example.com/3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Do something...</span>
            <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'http://foo.example.com/4'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Do something...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason4<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码就是传说中的 <code>回调地狱</code>，它本身存在着一些问题：<strong>无法表达清晰的逻辑</strong>、<strong>导致执行顺序不确定</strong>等。</p> <h3 id="promise-规范"><a href="#promise-规范" class="header-anchor">#</a> Promise 规范</h3> <p>正是由于以上原因才会有了 Promise 的诞生，下面我们来看一下 Promise 的规范。</p> <ul><li>Promise 对象的状态不受外界影响: <code>Promise</code> 对象有三种状态: <code>pending(进行中)</code>、<code>fulfilled(已成功)</code>、<code>rejected(已失败)</code>。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是 <code>Promise</code> 这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</li> <li>一旦状态改变，就不会再变，任何时候都可以得到这个结果: <code>Promise</code>对象的状态改变，只有两种可能：从<code>pending</code>变为<code>fulfilled</code>和从<code>pending</code>变为<code>rejected</code>。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 <code>resolved</code>（已定型）。如果改变已经发生了，你再对 Promise 对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</li></ul> <h2 id="要点总结"><a href="#要点总结" class="header-anchor">#</a> 要点总结</h2> <p><strong>Promise</strong></p> <ul><li><code>Promise</code> 是一个构造函数，接受一个函数作为参数，该函数有  <code>resolve</code>、<code>reject</code> 两个函数类型的参数(和 <code>e</code> 一样，由 Js 引擎提供)。</li> <li><code>Promise</code> 新建后，会立即执行(构造函数接受的函数)。</li> <li><code>resolve</code> 和 <code>reject</code> 都可以带一个参数，该参数会传递给 <code>Promise</code> 绑定的下一个 <code>then</code> 方法。而 <code>resolve</code> 函数的参数除了正常的值以外，还可能是另一个 <code>Promise</code> 对象。这时只有传入的 <code>Promise</code> 对象被改变，然后才会执行原有的 <code>then</code> 方法。而状态也遵循传入的 <code>Promise</code> 的状态。</li> <li>调用 <code>resolve</code> 或 <code>reject</code> 并不会终结 <code>Promise</code> 的参数函数的执行。<code>resolve/reject</code> 的 <code>Promise</code> 是在本轮事件循环的末尾执行，总是晚于本轮循环的同步任务。可在执行 <code>resolve/reject</code> 前面加 <code>return</code> 语句，这样就不会有意外。</li></ul> <p><strong>then</strong></p> <ul><li><code>Promise</code> 实例具有 <code>then</code> 方法。</li> <li><code>then</code> 方法会接收两个函数类型的参数，两个函数都是可选的。这两个函数的参数都是 <code>Promise</code> 对象传出的值。如果 <code>Promise</code> 成功，则会执行 <code>then</code> 的第一个函数，失败则会执行 <code>then</code> 的第二个参数。</li> <li><code>then</code> 方法会返回一个新的 <code>Promise</code>(不是原来那个 <code>Promise</code> 实例)。因此可以采用链式写法。</li> <li>后一个 <code>then</code> 总是依赖于前一个 <code>then</code> 的完成才会执行。</li></ul> <p><strong>catch</strong></p> <ul><li><code>Promise.prototype.catch()</code> 方法是 <code>.then(null, rejection)</code> 或 <code>.then(undefined, rejection)</code> 的别名，用于指定发生错误时的回调函数。</li> <li>在 <code>Promise</code> 和 <code>then</code> 方法里抛出错误的话，会被 <code>catch</code> 方法捕获。执行 <code>reject()</code> 方法的作用，等同于抛出错误。</li> <li>如果在 <code>catch</code> 之前的 <code>then</code> 方法有传入第二个参数，即 <code>rejection</code> 的话，<code>catch</code> 则不会被执行。</li> <li><code>Promise</code> 的状态已经变成 <code>resolve</code>，再抛出错误是无效的。</li> <li><code>Promise</code> 对象的错误具有“冒泡”性质，会一直向后传递，直到被捕获为止。也就是说，错误总是会被下一个 <code>catch</code> 语句捕获。</li> <li>不要在 <code>then</code> 方法里传入第二个参数(rejection)，而要统一用 <code>catch</code> 方法(<code>then</code> 方法里的错误，<code>then</code> 本身不会处理)。</li> <li><code>Promise</code> 对象抛出的错误不会传递到外层代码，即不会有任何反应(<code>Promise</code> 会吃掉错误)。</li> <li><code>catch</code> 跟 <code>then</code> 一样，会返回一个新的 <code>Promise</code> 对象，因此后面可以接着调用 <code>then/catch</code> 方法。</li> <li>如果没有报错，会跳过 <code>catch</code> 代码，执行之后的 <code>then/catch</code> 方法。</li> <li><code>catch</code> 内部仍然可以抛出错误，而被之后的 <code>catch</code> 捕获。</li> <li><code>promise</code> 对象里面同步代码抛出的错误在没有通过 <code>promise</code> 的 <code>catch</code> 方法捕获时是会打印报错的（不会阻止 <code>promise</code> 外面代码的执行），但是不会传递到外面触发其他错误监听函数（比如 <code>window.onerror</code> 、<code>try-catch</code> 等）</li></ul> <p><strong>finally</strong></p> <ul><li><code>finally</code> 本质上是 <code>then</code> 方法的特例 <code>.then(result =&gt; result, error =&gt; throw error)</code>。</li> <li>不管 <code>promise</code> 最后的状态，在执行完 <code>then</code> 或 <code>catch</code> 指定的回调函数以后，都会执行 <code>finally</code> 方法指定的回调函数。</li> <li><code>finally</code> 方法的回调函数不接受任何参数，<code>finally</code>方法里面的操作，应该是与状态无关的，不依赖于 <code>Promise</code> 的执行结果。</li> <li><code>finally</code> 方法总是会返回原来的值。</li></ul> <p><strong>all</strong></p> <ul><li><code>Promise.all()</code> 方法用于将多个 <code>Promise</code> 实例，包装成一个新的 <code>Promise</code> 实例。接受一个数组作为参数(可以不是数组，但必须具有 <code>Iterator</code> 接口，且返回的每个成员都是 <code>Promise</code> 实例)。如果数组里的值不是 <code>Promise</code> 实例，就会先调用 <code>Promise.resolve</code> 方法，将参数转化为 <code>Promise</code> 对象。</li> <li>只有 <code>p1、p2、p3</code> 的状态都变成 <code>fulfilled</code> ，<code>p</code> 的状态才会变成 <code>fulfilled</code> ，此时 <code>p1、p2、p3</code> 的返回值组成一个数组，传递给 <code>p</code> 的回调函数。</li> <li>只要 <code>p1、p2、p3</code> 之中有一个被 <code>rejected</code>，<code>p</code> 的状态就变成 <code>rejected</code>，此时第一个被 <code>reject</code> 的实例的返回值，会传递给 <code>p</code> 的回调函数。</li></ul> <p><strong>race</strong></p> <ul><li><code>Promise.race()</code> 方法同样是将多个 <code>Promise</code> 实例，包装成一个新的 <code>Promise</code> 实例。只要 <code>p1、p2、p3</code> 之中有一个实例率先改变状态，<code>p</code> 的状态就<strong>跟着改变</strong>。那个率先改变的 <code>Promise</code> 实例的返回值，就传递给 <code>p</code> 的回调函数。如果数组里的值不是 <code>Promise</code> 实例，就会先调用 <code>Promise.resolve</code> 方法，将参数转化为 <code>Promise</code> 对象。</li></ul> <p><strong>allSettled</strong></p> <ul><li><code>Promise.allSettled()</code>方法接受一个数组作为参数，数组的每个成员都是一个 <code>Promise</code> 对象，并返回一个新的 <code>Promise</code> 对象。</li> <li>只有等到参数数组的所有 <code>Promise</code> 对象都发生状态变更（不管是 <code>fulfilled</code> 还是 <code>rejected</code>），返回的 <code>Promise</code> 对象才会发生状态变更。</li> <li>该方法返回的新的 <code>Promise</code> 实例，一旦发生状态变更，状态总是 <code>fulfilled</code> ，不会变成 <code>rejected</code> 。状态变成 <code>fulfilled</code> 后，它的回调函数会接收到一个数组作为参数，该数组的每个成员对应前面数组的每个 <code>Promise</code> 对象。</li> <li>返回值 <code>results</code> 的每个成员是一个对象，对象的格式是固定的，对应异步操作的结果。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 异步操作成功时</span>
<span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token string">'fulfilled'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> value<span class="token punctuation">}</span>

<span class="token comment">// 异步操作失败时</span>
<span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token string">'rejected'</span><span class="token punctuation">,</span> reason<span class="token operator">:</span> reason<span class="token punctuation">}</span>
</code></pre></div><p><strong>any</strong></p> <ul><li><code>Promise.any()</code>方法。该方法接受一组 <code>Promise</code> 实例作为参数，包装成一个新的 <code>Promise</code> 实例返回。</li> <li>只要参数实例有一个变成 <code>fulfilled</code> 状态，包装实例就会变成 <code>fulfilled</code> 状态；如果所有参数实例都变成 <code>rejected</code> 状态，包装实例就会变成 <code>rejected</code> 状态。</li> <li><code>Promise.any()</code> 不会因为某个 <code>Promise</code> 变成 <code>rejected</code> 状态而结束，必须等到所有参数 <code>Promise</code> 变成 <code>rejected</code> 状态才会结束。</li> <li><code>Promise.any()</code> 抛出的错误，是一个 <code>AggregateError</code> 实例，相当于一个数组。每个成员对应一个被rejected的操作所抛出的错误。</li></ul> <p><strong>Promise.resolve()</strong></p> <ul><li><code>Promise.resolve()</code> 等价于 <code>new Promise(resolve =&gt; resolve('foo'))</code></li> <li><code>Promise.resolve()</code> 的参数有四种情况
<ul><li>参数是一个 Promise 实例
<ul><li><code>Promise.resolve</code> 将不做任何修改、原封不动地返回这个实例。</li></ul></li> <li>参数是一个 <code>thenable</code> 对象
<ul><li><code>thenable</code> 对象指的是具有 <code>then</code> 方法的对象</li> <li><code>Promise.resolve()</code> 方法会将这个对象转为 <code>Promise</code> 对象，然后就立即执行 <code>thenable</code> 对象的 <code>then()</code> 方法(挂载 <code>then</code> 方法，而不是立即执行 <code>then</code> 参数里的方法)。</li></ul></li> <li>参数不是具有<code>then()</code>方法的对象，或根本就不是对象
<ul><li><code>Promise.resolve()</code> 方法返回一个新的 <code>Promise</code> 对象，状态为 <code>resolved</code>。</li></ul></li> <li>不带有任何参数
<ul><li><code>Promise.resolve()</code> 方法允许调用时不带参数，直接返回一个 <code>resolved</code> 状态的 <code>Promise</code> 对象。</li></ul></li></ul></li> <li>立即<code>resolve()</code>的 <code>Promise</code> 对象，是在本轮“事件循环”（event loop）的结束时执行，而不是在下一轮“事件循环”的开始时。</li></ul> <p><strong>Promise.reject()</strong></p> <ul><li><code>Promise.reject(reason)</code> 方法也会返回一个新的 <code>Promise</code> 实例，该实例的状态为 <code>rejected</code>。</li> <li><code>Promise.reject()</code> 方法的参数，会原封不动地作为 <code>reject</code> 的理由，变成后续方法的参数。</li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://zhuanlan.zhihu.com/p/114151331" target="_blank" rel="noopener noreferrer">Promise/A+ 规范：诞生与原理初探<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.ituring.com.cn/article/66566" target="_blank" rel="noopener noreferrer">Promises/A+规范(中文版)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener noreferrer">阮一峰: ECMAScript 6 入门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/30/2021, 11:48:37 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blogs/promise/PromiseSourceCode.html">
        Promise 原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blogs/assets/js/app.0e5649ea.js" defer></script><script src="/blogs/assets/js/2.9858e944.js" defer></script><script src="/blogs/assets/js/29.ff31abe2.js" defer></script>
  </body>
</html>
