(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{383:function(s,t,a){"use strict";a.r(t);var e=a(44),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"服务器运维の骚操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器运维の骚操作"}},[s._v("#")]),s._v(" 服务器运维の骚操作")]),s._v(" "),a("p",[s._v("以下介绍一些 在实际维护服务器会用到的一些技巧。")]),s._v(" "),a("h2",{attrs:{id:"linux-免密登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-免密登录"}},[s._v("#")]),s._v(" Linux 免密登录")]),s._v(" "),a("h3",{attrs:{id:"_1-在本地生成公钥和私钥-如果已经生成过-跳过该步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-在本地生成公钥和私钥-如果已经生成过-跳过该步"}},[s._v("#")]),s._v(" 1. 在本地生成公钥和私钥 (如果已经生成过，跳过该步)")]),s._v(" "),a("p",[s._v("在本地系统打开控制台，并输入以下指令。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ssh-keygen  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等同于 ssh-keygen -t rsa")]),s._v("\n")])])]),a("p",[s._v("输入上面的命令后，一路回车即可。运行结束后，会在本地生成两个文件:")]),s._v(" "),a("ul",[a("li",[s._v("id_rsa: 私钥")]),s._v(" "),a("li",[s._v("id_rsa.pub: 公钥")])]),s._v(" "),a("blockquote",[a("p",[s._v("windows 系统在 "),a("code",[s._v("C:\\Users\\<用户名>\\.ssh")]),s._v(" 下，linux 则在当前用户家目录下的 "),a("code",[s._v(".ssh")]),s._v(" 里。")])]),s._v(" "),a("h3",{attrs:{id:"_2-将公钥导入到服务器的认证文件中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-将公钥导入到服务器的认证文件中"}},[s._v("#")]),s._v(" 2. 将公钥导入到服务器的认证文件中")]),s._v(" "),a("p",[s._v("在刚才的 "),a("code",[s._v(".ssh")]),s._v(" 目录下打开控制台，并输入以下指令。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" id_rsa.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("用户名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务器地址"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("文件路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" id_rsa.pub root@10.135.193.200:~  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将文件 id_rsa.pub 发送到 root 用户的 家目录下")]),s._v("\n")])])]),a("p",[s._v("之后会提示输入密码，输入密码后会将文件发送到服务器。然后我们需要将数据写入到认证文件中。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/id_rsa.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/authorized_keys\n")])])]),a("h3",{attrs:{id:"_3-更改文件权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-更改文件权限"}},[s._v("#")]),s._v(" 3. 更改文件权限")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" ~\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" ~/.ssh/authorized_keys\n")])])]),a("h2",{attrs:{id:"强制所有用户密钥登录。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强制所有用户密钥登录。"}},[s._v("#")]),s._v(" 强制所有用户密钥登录。")]),s._v(" "),a("p",[s._v("我们需要修改登录配置文件 "),a("code",[s._v("/etc/ssh/sshd_config")]),s._v("，然后找到 "),a("code",[s._v("PasswordAuthentication")]),s._v(" 并修改为 "),a("code",[s._v("no")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("PasswordAuthentication no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示禁止密码方式的认证")]),s._v("\n\nsystemctl restart sshd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者 /etc/init.d/sshd reload")]),s._v("\n")])])]),a("h2",{attrs:{id:"禁止-root-使用密码登录服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁止-root-使用密码登录服务器"}},[s._v("#")]),s._v(" 禁止 root 使用密码登录服务器")]),s._v(" "),a("p",[s._v("我们还是要修改登录配置文件，找到 "),a("code",[s._v("PermitRootLogin")]),s._v(" 并修改为 "),a("code",[s._v("without-password")]),s._v("，当然也可以设置成 "),a("code",[s._v("no")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("PermitRootLogin without-password  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止 root 用户使用密码登录")]),s._v("\nPermitRootLogin no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止 root 用户登录")]),s._v("\n")])])]),a("h2",{attrs:{id:"修改默认登录端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改默认登录端口"}},[s._v("#")]),s._v(" 修改默认登录端口")]),s._v(" "),a("p",[s._v("打开登录配置文件，找到 "),a("code",[s._v("# Port 22")]),s._v(", 去掉 "),a("code",[s._v("#")]),s._v(" 号，并将端口号改成自己想要的端口号，然后重启服务。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl restart sshd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者 /etc/init.d/sshd reload")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记得打开对应端口的防火墙(firewall/iptabels)，如果是云服务器，则还要在云控制台打开对应的安全策略。")]),s._v("\n")])])]),a("p",[s._v("经过以上的骚操作，将会使别人更难登录到自己的服务器上。")])])}),[],!1,null,null,null);t.default=r.exports}}]);